version: '3.5'

services:
  indexservice:
    image: ${TARGET_REPO}/indexservice:${TARGET_TAG}
    build:
      context: ../../../../
      dockerfile: build/docker/deploy/distributed/indexservice/DockerFile
      cache_from:
        - ${SOURCE_REPO}/indexservice:${SOURCE_TAG}
    environment:
      MASTER_ADDRESS: ${MASTER_ADDRESS}
      ETCD_ADDRESS: ${ETCD_ADDRESS}
      MINIO_ADDRESS: ${MINIO_ADDRESS}

    networks:
      - milvus

  indexnode:
    image: ${TARGET_REPO}/indexnode:${TARGET_TAG}
    build:
      context: ../../../../
      dockerfile: build/docker/deploy/distributed/indexnode/DockerFile
      cache_from:
        - ${SOURCE_REPO}/indexnode:${SOURCE_TAG}
    environment:
      INDEX_SERVICE_ADDRESS: ${INDEX_SERVICE_ADDRESS}
      MINIO_ADDRESS: ${MINIO_ADDRESS}
    depends_on:
      - "indexservice"

    networks:
      - milvus

networks:
  milvus:
